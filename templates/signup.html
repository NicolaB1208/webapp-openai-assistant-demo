{% extends "layout.html" %}

{% block body %}

    <form method="POST">
        <label for="Username">Username:</label>
        <input autocomplete="off" autofocus id="username" name="name" placeholder="Choose a cool one" type="text">
        <label for="Password">Password:</label>
        <input autocomplete="off" id="password" name="password" placeholder="A strong one..." type="text">
        <button type="submit">Sign Up</button>
        <div id="user-exists-error" style="display:none; color: red">Username already taken. Please choose another one</div>
    </form>

    <script>

        // Add this script tag before the closing </body> tag, or in a separate .js file

        let input = document.querySelector("#username");

        input.addEventListener('input',async function() {
            try {
                let response = await fetch('/check_username', {
                    method: 'POST',
                    body: new URLSearchParams({"username": input.value}),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                });

                //Await the response from the fetch call and parse the JSON body
                let data = await response.json();

                // Conditionally display or hide the error message based on wheter the username exist already or not
                if(data.user_exists) {
                    document.getElementById("user-exists-error").style.display = 'block';
                } else {
                    document.getElementById("user-exists-error").style.display = 'none';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

    </script>

{% endblock %}
